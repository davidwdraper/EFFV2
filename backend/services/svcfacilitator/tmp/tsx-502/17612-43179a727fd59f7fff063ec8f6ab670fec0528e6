{"code":"__filename=\"/Users/ddraper005/eff/backend/services/shared/src/base/ControllerBase.ts\";(()=>{\nvar __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __hasOwnProp=Object.prototype.hasOwnProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from===\"object\"||typeof from===\"function\"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toCommonJS=mod=>__copyProps(__defProp({},\"__esModule\",{value:true}),mod);var ControllerBase_exports={};__export(ControllerBase_exports,{ControllerBase:()=>ControllerBase});module.exports=__toCommonJS(ControllerBase_exports);var import_ServiceBase=require(\"./ServiceBase\");class ControllerBase extends import_ServiceBase.ServiceBase{static{__name(this,\"ControllerBase\")}constructor(opts){super({service:opts?.service,context:{component:\"Controller\",...opts?.context??{}}})}ok(statusOrBody,maybeBody){if(typeof statusOrBody===\"number\"){return{status:statusOrBody,body:maybeBody}}return{status:200,body:statusOrBody}}fail(httpStatus,code,detail){return{ok:false,status:httpStatus,data:{status:code,detail}}}handle(business){const log=this.bindLog({kind:\"http\",adapter:\"controller_handle\"});return async(req,res,next)=>{try{const requestId=req.header(\"x-request-id\")||req.header(\"x-correlation-id\")||req.header(\"request-id\")||\"\";const headers={};for(const[k,v]of Object.entries(req.headers)){if(v==null)continue;headers[k.toLowerCase()]=Array.isArray(v)?String(v[0]):String(v)}const ctx={requestId,body:req.body,params:req.params??{},query:req.query??{},headers};log.debug({url:req.originalUrl,method:req.method},\"controller_enter\");const result=await business(ctx);if(result?.ok===false){const errRes=result;const statusCode2=errRes.status??500;res.status(statusCode2).json({ok:false,service:this.service,data:errRes.data});log.debug({status:statusCode2},\"controller_exit_error\");return}const okRes=result;const statusCode=okRes.status??200;const payload=okRes.body!==void 0?okRes.body:void 0;if(payload!==void 0){res.status(statusCode).json({ok:true,service:this.service,data:payload})}else{res.status(statusCode).json({ok:true,service:this.service})}log.debug({status:statusCode},\"controller_exit_ok\")}catch(err){log.error({err:String(err)},\"controller_error\");next(err)}}}}0&&(module.exports={ControllerBase});\n})()\n","warnings":[],"map":{"version":3,"mappings":";suBAAA,uJAuBA,uBAA4B,yBAsBrB,MAAe,uBAAuB,8BAAY,CA7CzD,MA6CyD,+BAC7C,YAAY,KAGnB,CACD,MAAM,CACJ,QAAS,MAAM,QACf,QAAS,CAAE,UAAW,aAAc,GAAI,MAAM,SAAW,CAAC,CAAG,CAC/D,CAAC,CACH,CAOU,GACR,aACA,UACe,CACf,GAAI,OAAO,eAAiB,SAAU,CACpC,MAAO,CAAE,OAAQ,aAAc,KAAM,SAAU,CACjD,CACA,MAAO,CAAE,OAAQ,IAAK,KAAM,YAAa,CAE3C,CAQU,KACR,WACA,KACA,OACe,CACf,MAAO,CAAE,GAAI,MAAO,OAAQ,WAAY,KAAM,CAAE,OAAQ,KAAM,MAAO,CAAE,CACzE,CAUO,OACL,SACgB,CAChB,MAAM,IAAM,KAAK,QAAQ,CAAE,KAAM,OAAQ,QAAS,mBAAoB,CAAC,EAEvE,MAAO,OAAO,IAAc,IAAe,OAAuB,CAChE,GAAI,CACF,MAAM,UAAa,IAAI,OAAO,cAAc,GAC1C,IAAI,OAAO,kBAAkB,GAC7B,IAAI,OAAO,YAAY,GACvB,GAEF,MAAM,QAAkC,CAAC,EACzC,SAAW,CAAC,EAAG,CAAC,IAAK,OAAO,QAAQ,IAAI,OAAO,EAAG,CAChD,GAAI,GAAK,KAAM,SACf,QAAQ,EAAE,YAAY,CAAC,EAAI,MAAM,QAAQ,CAAC,EACtC,OAAO,EAAE,CAAC,CAAC,EACX,OAAO,CAAC,CACd,CAEA,MAAM,IAAkB,CACtB,UACA,KAAO,IAAY,KACnB,OAAS,IAAI,QAAU,CAAC,EACxB,MAAQ,IAAI,OAAS,CAAC,EACtB,OACF,EAEA,IAAI,MACF,CAAE,IAAK,IAAI,YAAa,OAAQ,IAAI,MAAO,EAC3C,kBACF,EAEA,MAAM,OAAS,MAAM,SAAS,GAAG,EAGjC,GAAK,QAAgB,KAAO,MAAO,CACjC,MAAM,OAAS,OACf,MAAMA,YAAa,OAAO,QAAU,IACpC,IACG,OAAOA,WAAU,EACjB,KAAK,CAAE,GAAI,MAAO,QAAS,KAAK,QAAS,KAAM,OAAO,IAAK,CAAC,EAC/D,IAAI,MAAM,CAAE,OAAQA,WAAW,EAAG,uBAAuB,EACzD,MACF,CAGA,MAAM,MAAQ,OACd,MAAM,WAAa,MAAM,QAAU,IACnC,MAAM,QACH,MAAc,OAAS,OAAa,MAAc,KAAO,OAE5D,GAAI,UAAY,OAAW,CACzB,IACG,OAAO,UAAU,EACjB,KAAK,CAAE,GAAI,KAAM,QAAS,KAAK,QAAS,KAAM,OAAQ,CAAC,CAC5D,KAAO,CACL,IAAI,OAAO,UAAU,EAAE,KAAK,CAAE,GAAI,KAAM,QAAS,KAAK,OAAQ,CAAC,CACjE,CAEA,IAAI,MAAM,CAAE,OAAQ,UAAW,EAAG,oBAAoB,CACxD,OAAS,IAAK,CACZ,IAAI,MAAM,CAAE,IAAK,OAAO,GAAG,CAAE,EAAG,kBAAkB,EAClD,KAAK,GAAG,CACV,CACF,CACF,CACF","names":["statusCode"],"ignoreList":[],"sources":["/Users/ddraper005/eff/backend/services/shared/src/base/ControllerBase.ts"],"sourcesContent":[null]}}