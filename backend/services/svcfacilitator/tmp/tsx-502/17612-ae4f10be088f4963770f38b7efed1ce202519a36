{"code":"__filename=\"/Users/ddraper005/eff/backend/services/shared/src/domain/ServiceConfig.ts\";(()=>{\nvar __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __hasOwnProp=Object.prototype.hasOwnProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from===\"object\"||typeof from===\"function\"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toCommonJS=mod=>__copyProps(__defProp({},\"__esModule\",{value:true}),mod);var ServiceConfig_exports={};__export(ServiceConfig_exports,{ServiceConfig:()=>ServiceConfig});module.exports=__toCommonJS(ServiceConfig_exports);class ServiceConfig{static{__name(this,\"ServiceConfig\")}_id;slug;version;enabled;internalOnly;baseUrl;outboundApiPrefix;exposeHealth;changedByUserId;updatedAt;edgePolicies;s2sPolicies;constructor(props){this._id=props._id;this.slug=props.slug;this.version=props.version;this.enabled=props.enabled;this.internalOnly=props.internalOnly;this.baseUrl=props.baseUrl;this.outboundApiPrefix=props.outboundApiPrefix;this.exposeHealth=props.exposeHealth;this.changedByUserId=props.changedByUserId;this.updatedAt=props.updatedAt;this.edgePolicies=[...props.edgePolicies];this.s2sPolicies=[...props.s2sPolicies]}static fromDb(doc,policies){const id=asId(doc._id,\"_id\");const slug=asNonEmptyString(doc.slug,\"slug\");const version=asInt(doc.version,\"version\");const enabled=asBool(doc.enabled,\"enabled\");const internalOnly=asBool(doc.internalOnly,\"internalOnly\");const baseUrl=asNonEmptyString(doc.baseUrl,\"baseUrl\");const outboundApiPrefix=asNonEmptyString(doc.outboundApiPrefix,\"outboundApiPrefix\");const exposeHealth=asBool(doc.exposeHealth,\"exposeHealth\");const updatedAt=asIsoString(doc.updatedAt,\"updatedAt\");const changedByUserId=doc.changedByUserId===void 0?void 0:asNonEmptyString(doc.changedByUserId,\"changedByUserId\");if(!enabled)throw new Error(buildErr(\"enabled must be true for mirrored configs\",{id,slug,version}));if(version<1)throw new Error(buildErr(\"version must be >= 1\",{id,slug,version}));if(!Array.isArray(policies?.edge)||!Array.isArray(policies?.s2s)){throw new Error(buildErr(\"policies.edge and policies.s2s must be arrays\",{id,slug,version}))}return new ServiceConfig({_id:id,slug,version,enabled,internalOnly,baseUrl,outboundApiPrefix,exposeHealth,changedByUserId,updatedAt,edgePolicies:policies.edge.filter(p=>p&&p.enabled===true),s2sPolicies:policies.s2s.filter(p=>p&&p.enabled===true)})}key(){return`${this.slug}@${this.version}`}toJSON(){return{_id:this._id,slug:this.slug,version:this.version,enabled:true,internalOnly:this.internalOnly,baseUrl:this.baseUrl,outboundApiPrefix:this.outboundApiPrefix,exposeHealth:this.exposeHealth,changedByUserId:this.changedByUserId,updatedAt:this.updatedAt,policies:{edge:this.edgePolicies,s2s:this.s2sPolicies}}}}function asId(v,field){if(typeof v===\"string\")return v;if(v&&typeof v===\"object\"){const any=v;if(typeof any.$oid===\"string\")return any.$oid;if(typeof any.toHexString===\"function\")return any.toHexString()}throw new Error(buildErr(`field '${field}' must be string`,{got:String(v)}))}__name(asId,\"asId\");function asNonEmptyString(v,field){if(typeof v===\"string\"&&v.trim().length>0)return v;throw new Error(buildErr(`field '${field}' must be non-empty string`,{got:String(v)}))}__name(asNonEmptyString,\"asNonEmptyString\");function asInt(v,field){if(typeof v===\"number\"&&Number.isInteger(v))return v;throw new Error(buildErr(`field '${field}' must be integer`,{got:String(v)}))}__name(asInt,\"asInt\");function asBool(v,field){if(typeof v===\"boolean\")return v;throw new Error(buildErr(`field '${field}' must be boolean`,{got:String(v)}))}__name(asBool,\"asBool\");function asIsoString(v,field){if(v instanceof Date)return v.toISOString();if(typeof v===\"string\"&&v.length>0)return v;const d=new Date(v);if(!Number.isNaN(d.getTime()))return d.toISOString();throw new Error(buildErr(`field '${field}' must be Date or ISO string`,{got:String(v)}))}__name(asIsoString,\"asIsoString\");function buildErr(msg,ctx){const tail=Object.keys(ctx).length?` | ctx=${JSON.stringify(ctx)}`:\"\";return`ServiceConfig.fromDb violation: ${msg}${tail}`}__name(buildErr,\"buildErr\");0&&(module.exports={ServiceConfig});\n})()\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/ddraper005/eff/backend/services/shared/src/domain/ServiceConfig.ts"],"sourcesContent":[null]}}