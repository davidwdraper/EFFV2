// backend/services/svcconfig/src/bootstrap.ts

import path from "path";
import { loadEnvFromFileOrThrow, assertRequiredEnv } from "@eff/shared/src/env";

// ── Service identity (allowed to be baked in) ────────────────────────────────
export const SERVICE_NAME = "svcconfig" as const;

// ── ENV file resolution ─────────────────────────────────────────────────────
// Require ENV_FILE to be set externally (no defaults baked in).
const envFile = process.env.ENV_FILE;
if (!envFile || !envFile.trim()) {
  throw new Error(
    `[bootstrap:${SERVICE_NAME}] ENV_FILE is required (none provided)`
  );
}

// Always resolve relative to the monorepo root
const resolved = path.resolve(__dirname, "../../../..", envFile);

console.log(`[bootstrap:${SERVICE_NAME}] Loading env from: ${resolved}`);
loadEnvFromFileOrThrow(resolved);

// ── Required envs for this service ──────────────────────────────────────────
assertRequiredEnv([
  "LOG_LEVEL",
  "LOG_SERVICE_URL",
  "SVCCONFIG_MONGO_URI",
  "SVCCONFIG_PORT",
  // S2S verification (this service is worker-facing)
  "S2S_JWT_SECRET",
  "S2S_AUDIENCE",
  "S2S_ALLOWED_ISSUERS",
  "S2S_ALLOWED_CALLERS",
  "S2S_CLOCK_SKEW_SEC",
]);
